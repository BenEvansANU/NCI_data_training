

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Access Magnetic Intensity grid data using NCSS &mdash; NCI data training  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> NCI data training
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../_overview/overview.html">Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_data/where_to_find_data.html">Where to Find Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_data/where_to_get_data.html">Where to Get Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_data/how_to_use_data.html">How to Use Data</a></li>
</ul>
<p class="caption"><span class="caption-text">How to run Jupyter notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prep/install_jupyter.html">Install Jupyter and Python on your local machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep/python_on_vdi.html">Setup Python environment on the VDI</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples grouped by theme</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../climate/climate.html">Climate and Environment Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eo/eo.html">Earth Observation</a></li>
<li class="toctree-l1"><a class="reference internal" href="geophysics.html">Geophysics</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples grouped by service type</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tds/tds.html">THREDDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gsky/gsky.html">GSKY</a></li>
</ul>
<p class="caption"><span class="caption-text">Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_help/help.html">Help</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NCI data training</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Access Magnetic Intensity grid data using NCSS</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/_notebook/geophysics/NCSS_mag.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p><img alt="logo" src="../../_images/NCI_logo2.png" /></p>
<div class="section" id="Access-Magnetic-Intensity-grid-data-using-NCSS">
<h1>Access Magnetic Intensity grid data using NCSS<a class="headerlink" href="#Access-Magnetic-Intensity-grid-data-using-NCSS" title="Permalink to this headline">¶</a></h1>
<p>In this notebook,</p>
<ul class="simple">
<li>obtain service end points</li>
<li>display subset datasets</li>
</ul>
<p>This example was developed by Alex Ip (<a class="reference external" href="mailto:Alex&#46;Ip&#37;&#52;&#48;ga&#46;gov&#46;au">Alex<span>&#46;</span>Ip<span>&#64;</span>ga<span>&#46;</span>gov<span>&#46;</span>au</a>). See more exmples <a class="reference external" href="https://github.com/GeoscienceAustralia/geophys_utils/tree/master/examples">here</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="k">import</span> <span class="n">exposure</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pprint</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">lxml.etree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Set NCSS endpoint, bounding box and netCDF file output path</span>
<span class="n">ncss_endpoint</span> <span class="o">=</span> <span class="s1">&#39;http://dap-wms.nci.org.au/thredds/ncss/rr2/geophysics/magmap_v6_2015_VRTP/magmap_v6_2015_VRTP.nc&#39;</span>
<span class="n">bbox_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">135</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">]</span>
<span class="n">nc_output_path</span> <span class="o">=</span> <span class="s1">&#39;C:/Temp/ncss_test.nc&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Define function to read netCDf subset and write to netCDF file and return variable_details_list</span>
<span class="k">def</span> <span class="nf">get_netcdf_subset</span><span class="p">(</span><span class="n">ncss_endpoint</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">,</span> <span class="n">nc_output_path</span><span class="p">,</span> <span class="n">horizStride</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to read netCDf subset and write to netCDF file and return variable_details_list</span>
<span class="sd">    See the following page for details:</span>
<span class="sd">    https://www.unidata.ucar.edu/software/thredds/current/tds/reference/NetcdfSubsetServiceReference.html</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Get dataset description XML</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ncss_endpoint</span> <span class="o">+</span> <span class="s1">&#39;/dataset.xml&#39;</span><span class="p">)</span>
    <span class="n">dataset_description</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="c1">#print(response.content)</span>

    <span class="c1"># Read variable details from dataset description XML tree</span>
    <span class="c1"># N.B: This is a bit of a hack which will fail if there are multiple grid resolutions in the one dataset,</span>
    <span class="c1"># but it&#39;s OK when there&#39;s only one</span>
    <span class="n">variable_details_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">grid_element</span><span class="o">.</span><span class="n">attrib</span> <span class="k">for</span> <span class="n">grid_element</span> <span class="ow">in</span> <span class="n">dataset_description</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.//grid&#39;</span><span class="p">)]</span>
    <span class="c1">#pprint(variable_details)</span>

    <span class="c1"># Setup request parameters</span>
    <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;var&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">variable_details</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                                 <span class="k">for</span> <span class="n">variable_details</span> <span class="ow">in</span> <span class="n">variable_details_list</span><span class="p">]),</span>
                    <span class="s1">&#39;west&#39;</span><span class="p">:</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;east&#39;</span><span class="p">:</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="s1">&#39;south&#39;</span><span class="p">:</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;north&#39;</span><span class="p">:</span> <span class="n">bbox_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                    <span class="s1">&#39;horizStride&#39;</span><span class="p">:</span> <span class="n">horizStride</span>
                    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ncss_endpoint</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;Request failed with response code </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                                                                                          <span class="n">response</span><span class="o">.</span><span class="n">content</span>
                                                                                          <span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nc_output_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">nc_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">variable_details_list</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">hillshade</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">angle_altitude</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Hillshade function adapted from:</span>
<span class="sd">    http://geoexamples.blogspot.com/2014/03/shaded-relief-images-using-gdal-python.html</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">))</span>
    <span class="n">aspect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">azimuthrad</span> <span class="o">=</span> <span class="n">azimuth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
    <span class="n">altituderad</span> <span class="o">=</span> <span class="n">angle_altitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>

    <span class="n">shaded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">altituderad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>\
     <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">altituderad</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>\
     <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">azimuthrad</span> <span class="o">-</span> <span class="n">aspect</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="n">shaded</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Retrieve subset and write to file</span>
<span class="n">variable_details_list</span> <span class="o">=</span> <span class="n">get_netcdf_subset</span><span class="p">(</span><span class="n">ncss_endpoint</span><span class="p">,</span> <span class="n">bbox_list</span><span class="p">,</span> <span class="n">nc_output_path</span><span class="p">,</span> <span class="n">horizStride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Open file for reading</span>
<span class="n">netcdf_dataset</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_output_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">netcdf_dataset</span><span class="o">.</span><span class="vm">__dict__</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>OrderedDict([(&#39;_NCProperties&#39;,
              &#39;version=1|netcdflibversion=4.4.1|hdf5libversion=1.8.18&#39;),
             (&#39;GDAL&#39;, &#39;GDAL 1.11.1, released 2014/09/24&#39;),
             (&#39;geospatial_lon_min&#39;, 134.999606777),
             (&#39;geospatial_lon_resolution&#39;, 0.00083333),
             (&#39;geospatial_lat_max&#39;, -20.000240777000002),
             (&#39;geospatial_bounds_crs&#39;,
              &#39;GEOGCS[&quot;WGS 84&quot;,\n    DATUM[&quot;WGS_1984&quot;,\n        SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,\n            AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],\n        AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],\n    PRIMEM[&quot;Greenwich&quot;,0,\n        AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],\n    UNIT[&quot;degree&quot;,0.0174532925199433,\n        AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],\n    AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]&#39;),
             (&#39;geospatial_lat_min&#39;, -25.000238777000003),
             (&#39;geospatial_lat_resolution&#39;, 0.00083333),
             (&#39;geospatial_lat_units&#39;, &#39;degrees&#39;),
             (&#39;geospatial_lon_units&#39;, &#39;degrees&#39;),
             (&#39;geospatial_bounds&#39;,
              &#39;POLYGON((147.9754 -43.9236, 145.6104 -43.9061, 145.2663 -43.9001, 115.9829 -35.0230, 115.4506 -34.8148, 114.9457 -34.4447, 114.8626 -34.3367, 114.8200 -34.2771, 114.0518 -33.1620, 113.0639 -27.9044, 112.7170 -26.0044, 112.5113 -23.3111, 112.5071 -23.1161, 112.5078 -23.0802, 112.9208 -21.3720, 115.9177 -18.2747, 122.4740 -12.7266, 124.5164 -11.1091, 126.0164 -10.0507, 126.1170 -10.0007, 126.8163 -9.7089, 127.3822 -9.4847, 127.6838 -9.3751, 131.9863 -9.0628, 132.0054 -9.0627, 142.3180 -9.9501, 142.3389 -9.9573, 152.9134 -20.9828, 154.6612 -29.0902, 154.6611 -29.6302, 149.0333 -42.4411, 148.9670 -42.5565, 148.8275 -42.7895, 148.5900 -43.1812, 148.3542 -43.5662, 148.1337 -43.9215, 147.9754 -43.9236))&#39;),
             (&#39;geospatial_lon_max&#39;, 139.999604777),
             (&#39;uuid&#39;, &#39;221dcfd8-04ef-5083-e053-10a3070a64e3&#39;),
             (&#39;ecat_id&#39;, &#39;89596&#39;),
             (&#39;title&#39;,
              &#39;Total Magnetic Intensity (TMI) Grid of Australia with Variable Reduction to Pole (VRTP) - sixth edition&#39;),
             (&#39;source&#39;,
              &#39;The variable reduction to Pole (VRTP) grid was processed from the 2015 Total Magnetic Intensity (TMI) grid of the Australia region. The later grid is made of a compilation of 31,500,000 line-kilometres of survey data acquired by the Commonwealth, State and Territory Governments, the mining and exploration industry, universities and research organisations.&#39;),
             (&#39;summary&#39;,
              &#39;Total magnetic intensity (TMI) data measures variations in the intensity of the Earth magnetic field caused by the contrasting content of rock-forming minerals in the Earth crust. Magnetic anomalies can be either positive (field stronger than normal) or negative (field weaker) depending on the susceptibility of the rock. \nA variable reduction to Pole is aimed at locating magnetic anomalies exactly above their source bodies and without any distortion. \nThe 2015 Total magnetic Intensity (TMI) grid of Australia with variable reduction to pole (VRTP) has a grid cell size of ~3 seconds of arc (approximately 80 m). This grid only includes airborne-derived TMI data for onshore and near-offshore continental areas. The VRTP processing followed a differential reduction to pole calculation up to 5th order polynomial. Magnetic inclination and declination were derived from the IGRF-11 geomagnetic reference model using a data representative date of January 2005 and elevation 300 m.&#39;),
             (&#39;product_version&#39;, &#39;Version 2.0, April 2015&#39;),
             (&#39;date_created&#39;, &#39;2017-09-07T04:22:56, 2015-01-27T00:00:00&#39;),
             (&#39;date_modified&#39;, &#39;2017-09-07T04:22:56, 2015-01-27T00:00:00&#39;),
             (&#39;history&#39;,
              &quot;The variable reduction to Pole (VRTP) grid of Australia is processed from the 2015 TMI grid of the Australian region. The TMI grid is the sixth edition magnetic grid with a cell size of ~3 seconds of arc (approximately 80 m). This grid only includes airborne-derived TMI data for onshore and near-offshore continental areas. Since the fifth edition was released in 2010 data from 41 new surveys have been added to the database, acquired mainly by the State and Territory Geological Surveys. It is estimated that 31,500,000 line-kilometres of survey data were acquired to produce the grid data, 4,500,000 line-kilometres more than for the previous edition. \nMatching of the grids in the database was achieved using a program called Gridmerge, which was originally developed within Geoscience Australia and has now been commercialised. This program was used to merge 41 new surveys to the 5th Edition Total Magnetic Intensity Anomaly Grid of Australia (Milligan et al., 2010). \nThe 5th Edition merged 795 individual grids to create the compilation. To constrain long wavelengths, an independent data set, the Australia-wide Airborne Geophysical Survey (AWAGS) airborne magnetic data, was used to control the base levels of those survey grids which overlapped the AWAGS data (Milligan et al., 2009). As the 5th Edition was used as a base grid for the Gridmerge operation, the new 6th Edition is essentially levelled to AWAGS.\nThe VRTP processing followed Cooper and Cowan&#39;s (2005) differential reduction to pole up to 5th order polynomial. Magnetic inclination and declination were derived from the IGRF-11 geomagnetic reference model (Finlay et al., 2010) using a data representative date of January 2005 and elevation 300 m.\nThe original grid was converted from ERMapper (.ers) format to netCDF4_classic format using GDAL1.11.1. The main purpose of this conversion is to enable access to the data by relevant open source tools and software. The netCDF grid was created on 2016-03-29. \nReferences\nCooper, G.R.J., Cowan, D.R., 2005. Differential reduction to the pole, Computers &amp; Geosciences, Vol. 31, Issue 8, pp. 989-999.\nFinlay, C.C., Maus, S., Beggan, C.D., Bondar, T. N., Chambodut, A., Chernova, T.A., Chulliat, A., Golovkov, V.P., Hamilton, B., Hamoudi, M., Holme, R., Hulot, G., Kuang, W., Langlais, B., Lesur, V., Lowes, F.J. LA14hr, H., Macmillan, S., Mandea, M., McLean, S., Manoj, C., Menvielle, M., Michaelis, I., Olsen, N., Rauberg, J., Rother,M., Sabaka, T.J., Tangborn, A., TA ffner-Clausen, L., ThAbault, E., Thomson, A.W.P., Wardinski, I., Wei1, Z. and Zvereva, T.I., 2010. International Geomagnetic Reference Field: the eleventh generation, Geophysical Journal International, vol. 183, pp. 1216-1230.\nMilligan, P.R., Franklin, R., Minty, B.R.S., Richardson, L.M. and Percival, P.J., 2010. Magnetic Anomaly Map of Australia (Fifth Edition), 1:5 000 000 scale, Geoscience Australia, Canberra.\n20170906 NetCDF file restructured to be indexed Southward-positive for improved performance and interoperability&quot;),
             (&#39;institution&#39;,
              &#39;Commonwealth of Australia (Geoscience Australia)&#39;),
             (&#39;keywords&#39;,
              &#39;RTP, magnetics, magnetism and palaeomagnetism, airborne digital data, reduction to pole, national geophysical compilation, Earth sciences, geophysics, NCI, Australia, grid, ANVGL&#39;),
             (&#39;license&#39;,
              &#39;Creative Commons Attribution 4.0 International Licence&#39;),
             (&#39;doi&#39;, &#39;http://dx.doi.org/10.4225/25/5625EB0429F0D&#39;),
             (&#39;metadata_link&#39;,
              &#39;https://pid.nci.org.au/dataset/221dcfd8-04ef-5083-e053-10a3070a64e3&#39;),
             (&#39;Conventions&#39;, &#39;CF-1.6, ACDD-1.3&#39;),
             (&#39;History&#39;,
              &#39;Translated to CF-1.0 Conventions by Netcdf-Java CDM (CFGridWriter2)\nOriginal Dataset = /g/data/rr2/national_geophysical_compilations/magmap_v6_2015_VRTP/magmap_v6_2015_VRTP.nc; Translation Date = 2019-05-03T02:19:41.950Z&#39;)])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Plot first (and only) grid variable</span>
<span class="n">variable_name</span> <span class="o">=</span> <span class="n">variable_details_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> has shape </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">netcdf_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">netcdf_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mag_tmi_rtp_anomaly has shape (3001, 3001)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x1ca5acf2128&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_notebook_geophysics_NCSS_mag_8_2.png" src="../../_images/_notebook_geophysics_NCSS_mag_8_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot interpolated grid with histogram equalisation</span>
<span class="c1"># Substitute minimum value for NaN values</span>
<span class="n">masked_grid</span> <span class="o">=</span> <span class="n">netcdf_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">][:]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">exposure</span><span class="o">.</span><span class="n">equalize_hist</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">masked_grid</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x1ca5dbe4160&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_notebook_geophysics_NCSS_mag_9_1.png" src="../../_images/_notebook_geophysics_NCSS_mag_9_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hs_array</span> <span class="o">=</span> <span class="n">hillshade</span><span class="p">(</span><span class="n">masked_grid</span><span class="p">,</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hs_array</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x1ca5e628d68&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/_notebook_geophysics_NCSS_mag_10_1.png" src="../../_images/_notebook_geophysics_NCSS_mag_10_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, NCI

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>