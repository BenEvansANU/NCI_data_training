

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pangeo Setup on Raijin/Gadi to run Xarray and Dask &mdash; NCI data training  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> NCI data training
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../_overview/overview.html">Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_data/where_to_find_data.html">Where to Find Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_data/where_to_get_data.html">Where to Get Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_data/how_to_use_data.html">How to Use Data</a></li>
</ul>
<p class="caption"><span class="caption-text">How to run Jupyter notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prep/install_jupyter.html">Install Jupyter and Python on your local machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep/python_on_vdi.html">Setup Python environment on the VDI</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples grouped by theme</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../climate/climate.html">Climate and Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eo/eo.html">Earth Observation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geophysics/geophysics.html">Geophysics</a></li>
<li class="toctree-l1"><a class="reference internal" href="general.html">Other examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples grouped by service type</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tds/tds.html">THREDDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gsky/gsky.html">GSKY</a></li>
</ul>
<p class="caption"><span class="caption-text">Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_help/help.html">Help</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NCI data training</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Pangeo Setup on Raijin/Gadi to run Xarray and Dask</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/_notebook/general/Dask_setup_on_Gadi.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p><img alt="logo" src="../../_images/NCI_logo7.png" /></p>
<hr class="docutils" />
<div class="section" id="Pangeo-Setup-on-Raijin/Gadi-to-run-Xarray-and-Dask">
<h1>Pangeo Setup on Raijin/Gadi to run Xarray and Dask<a class="headerlink" href="#Pangeo-Setup-on-Raijin/Gadi-to-run-Xarray-and-Dask" title="Permalink to this headline">¶</a></h1>
<p>In this notebook:</p>
<ul class="simple">
<li>Install conda and create an environment</li>
<li>Configure Jupyter</li>
<li>Launch Dask with a job scheduler</li>
<li>Launch a Jupyter server for yoru job</li>
<li>Connect to Jupyter and the Dask dashboard from your local computer</li>
</ul>
<p>This example is created based on the document of from <a class="reference external" href="http://pangeo.io/setup_guides/hpc.html">Pangeo website</a>.</p>
<div class="section" id="Installing-a-software-environment">
<h2>Installing a software environment<a class="headerlink" href="#Installing-a-software-environment" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Login Gadi</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -l aaa777 raijin.nci.org.au
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Make a new directory in where you install your own software, download and install Miniconda</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir pangeo
$ wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
$ chmod +x Miniconda3-latest-Linux-x86_64.sh
$ ./Miniconda3-latest-Linux-x86_64.sh
</pre></div>
</div>
<p><img alt="image0" src="../../_images/pangeo10.png" /></p>
<ol class="arabic simple" start="3">
<li>The license agreement will prompt for you to read. Press ENTER. Type &gt;&gt;&gt; yes in the end.</li>
</ol>
<p><img alt="image1" src="../../_images/pangeo11.png" /></p>
<ol class="arabic simple" start="4">
<li>The default intallation path will be in your home directory, you can modify the path by specify the location.</li>
</ol>
<p><img alt="image2" src="../../_images/pangeo3.png" /></p>
<ol class="arabic simple" start="5">
<li>When installation is complete, you will be asked whether you want to initalise the enviornment. If you choose yes, then your default enviornment will conda when you login Raijin every single time. If you choose no, you can still activate your environment later on. We choose NO as we want to use pangeo environment in this case.</li>
</ol>
<p><img alt="image3" src="../../_images/pangeo4.png" /></p>
<ol class="arabic simple" start="6">
<li>Now we manually activate the conda enviornment.</li>
</ol>
<p><img alt="image4" src="../../_images/pangeo5.png" /></p>
<ol class="arabic simple" start="7">
<li>Create a new conda environment. Depending on your application, you may choose to add additional conda packages to this list. You can choose your own name. Here we use <strong>pangeo</strong> as the environment name.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda create -n pangeo -c conda-forge \
python=3.6 xarray \
jupyterlab nbserverproxy \
dask distributed mpi4py dask-jobqueue
</pre></div>
</div>
<p>Depending on your application, you may choose to add additional conda packages to this list.</p>
<p><img alt="image5" src="../../_images/pangeo6.png" /></p>
<ol class="arabic simple" start="8">
<li>Activate this environment</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda activate pangeo
</pre></div>
</div>
<p><img alt="image6" src="../../_images/pangeo7.png" /></p>
<p>Your prompt should now look something like this. You can check which python pangeo is using.</p>
<p><img alt="image7" src="../../_images/pangeo8.png" /></p>
</div>
<div class="section" id="Configure-Jupyter">
<h2>Configure Jupyter<a class="headerlink" href="#Configure-Jupyter" title="Permalink to this headline">¶</a></h2>
<p>Jupyter notebook servers include a password for security. We’re going to setup a password for ourselves. First we generate the Jupyter config file and invoking the commond when using recent Jupyter iteration. This created a file in ~/.jupyter/jupyter_notebook_config.py, where your password is stored.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(pangeo)$ jupyter notebook --generate-config
(pangeo)$ jupyter notebook password
</pre></div>
</div>
<p><img alt="image0" src="../../_images/pangeo10.png" /></p>
</div>
<div class="section" id="Set-up-a-Dask-jobqueue-using-PBS-job-scheduler">
<h2>Set up a Dask jobqueue using PBS job scheduler<a class="headerlink" href="#Set-up-a-Dask-jobqueue-using-PBS-job-scheduler" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>You need two files (<a class="reference external" href="https://github.com/jbw900/Dev/blob/master/pangeo.ini.all.sh">pangeo.ini.all.sh</a> and <a class="reference external" href="https://github.com/jbw900/Dev/blob/master/pangeo.worker.sh">pangeo.worker.sh</a>) to set up the jobqueue on Gadi. You can download a copy from the link above and store them in the executable directory, such as /short/z00/jbw900/apps/pangeo/26092019/envs/pangeo/bin/.</li>
</ol>
<div class="section" id="Remember-to-modify-the-path-in-those-two-files-to-match-your-case.">
<h3>Remember to modify the path in those two files to match your case.<a class="headerlink" href="#Remember-to-modify-the-path-in-those-two-files-to-match-your-case." title="Permalink to this headline">¶</a></h3>
<p><img alt="image0" src="../../_images/pangeo10.png" /></p>
<ol class="arabic simple" start="2">
<li>Create a new directory to do your work.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(pangeo)$ mkdir pangeo_test
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Raijin/Gadi uses the PBS job scheduler</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(pangeo)$ qsub -I -q express -lncpus=32,mem=64GB,jobfs=100GB
</pre></div>
</div>
<p>In this example, we require two nodes, 32cpus each, 64GB memory. It will take a little while before your get the resource that you asked for depending on the queue among other users in your group.</p>
<p><img alt="image1" src="../../_images/pangeo11.png" /></p>
<ol class="arabic simple" start="4">
<li>Once it is complete, two files should appears.</li>
</ol>
<ul class="simple">
<li>schedular.json</li>
<li>xxx.sh</li>
</ul>
</div>
</div>
<div class="section" id="Set-up-password-free-login">
<h2>Set up password free login<a class="headerlink" href="#Set-up-password-free-login" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>You might want to set up password free by adding your public key on Gadi. This will make handy later when you open your notebook on your local computer while interacting with Raijin/Gadi. Firsly, you need to find the public key of your computer.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd
$ cd .ssh
$ ls
</pre></div>
</div>
<p>Notes: If the id_rsa.pub exist, copy the content of file id_rsa.pub. If not exist, check <a class="reference external" href="https://help.github.com/en/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">here</a> for instruction on how to generate ssh keys.</p>
<ol class="arabic simple" start="2">
<li>Login to Raijin/Gadi. In your home directory, find <em>authorised_keys</em> file, if not, you can create one. Paste your key into the file called authorized_keys.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd
$ cd .ssh
$ emacs -nw authorized_keys
$ exit
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Logout and reconnect to Raijin/Gadi</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh -l aaa777 raijin.nci.org.au
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Now you should be able to login Raijin/Gadi without password prompt.</li>
</ol>
</div>
<div class="section" id="Open-up-the-Jupyter-Notebook-on-your-local-computer">
<h2>Open up the Jupyter Notebook on your local computer<a class="headerlink" href="#Open-up-the-Jupyter-Notebook-on-your-local-computer" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Copy those files into the your local computer. Now the connection between Raijin and your local computer is established.</li>
<li>You can open the your web browser, type localhost:xxxx to work on your notebook. The requests from your notebook allows you interactly work and communicate with Raijin/Gadi.</li>
<li>On a new tab, type localhost:xxxx son your web browser, then you can monitor the job threads using the Dask dashboard</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, NCI

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>