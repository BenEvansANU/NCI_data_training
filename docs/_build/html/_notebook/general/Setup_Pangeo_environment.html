

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setup Pangeo Environment &mdash; NCI data training  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> NCI data training
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../_overview/overview.html">Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_data/where_to_find_data.html">Where to Find Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_data/where_to_get_data.html">Where to Get Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_data/how_to_use_data.html">How to Use Data</a></li>
</ul>
<p class="caption"><span class="caption-text">How to run Jupyter notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../prep/install_jupyter.html">Install Jupyter and Python on your local machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep/python_on_vdi.html">Setup Python environment on the VDI</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples grouped by theme</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../climate/climate.html">Climate and Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eo/eo.html">Earth Observation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geophysics/geophysics.html">Geophysics</a></li>
<li class="toctree-l1"><a class="reference internal" href="general.html">Other examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook examples grouped by service type</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tds/tds.html">THREDDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gsky/gsky.html">GSKY</a></li>
</ul>
<p class="caption"><span class="caption-text">Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_help/help.html">Help</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NCI data training</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Setup Pangeo Environment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/_notebook/general/Setup_Pangeo_environment.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p><img alt="logo" src="../../_images/NCI_logo7.png" /></p>
<hr class="docutils" />
<div class="section" id="Setup-Pangeo-Environment">
<h1>Setup Pangeo Environment<a class="headerlink" href="#Setup-Pangeo-Environment" title="Permalink to this headline">¶</a></h1>
<p>In this notebook:</p>
<ul class="simple">
<li>Load Pangeo module</li>
<li>Activate pangeo enviornment</li>
<li>Run a jupyter notebook</li>
<li>Open the port at your local host to work on your notebook remotely</li>
<li>Visulise job dashboard</li>
</ul>
<hr class="docutils" />
<p><strong>Pangeo</strong> is a community platform for big data in geoscience, funded by US NSF. Pangeo project serves as a coordination point between scientists, software and computing infrastructure. The Pangeo software ecosystem involves open source tools such as xarray, iris, dask, jupyter, and many other packages. <a class="reference external" href="http://pangeo.io">This site</a> provides guidance for accessing data and performing analysis using these tools. NCI has installed the Pangeo environment on Raijin by following instructions
<a class="reference external" href="http://pangeo.io/setup_guides/hpc.html">here</a>. Please note that Pangeo will be transferred to Gadi when major Raijin/Gadi transition happens in Nov/Dec.&nbsp;It will not be available on Raijin from transition period onwards. This notebook provides instructions on how to use the Pangeo environment to run your jupyter notebook locally and interact with Raijin remotely on Raijin.</p>
<div class="section" id="Load-Pangeo-module-from-Raijin-and-activate-Pangeo-environment">
<h2>Load Pangeo module from Raijin and activate Pangeo environment<a class="headerlink" href="#Load-Pangeo-module-from-Raijin-and-activate-Pangeo-environment" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ module load pangeo/2019.10
$ source ${PANGEO_ROOT}/etc/profile.d/conda.sh
$ conda activate pangeo
</pre></div>
</div>
<p>You will see pangeo appear in the bracets in front of the promt sign. You can quit the enviornment using <strong>conda deactivate</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$codna deactivate
</pre></div>
</div>
<p><img alt="1" src="../../_images/pangeo_setup1.png" /></p>
<p>If you ask where your Python command lives, it should direct you to where pangeo was installed on Raijin.</p>
<p><img alt="2" src="../../_images/pangeo_setup2.png" /></p>
</div>
<div class="section" id="Configure-Jupyter">
<h2>Configure Jupyter<a class="headerlink" href="#Configure-Jupyter" title="Permalink to this headline">¶</a></h2>
<p>Run the following two lines of command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ jupyter notebook --generate-config
$ jupyter notebook password
</pre></div>
</div>
<p>It will promote you to enter a password for opening jupyter notebook on your local machine later. You can simply type a password and you need to remember it!</p>
<p>If the command does not work (often in older versions of Jupyter), there are <a class="reference external" href="http://pangeo.io/setup_guides/hpc.html">instructions</a> on how to set up step-by-step.</p>
</div>
<div class="section" id="Start-a-Jupyter-Notebook-Server">
<h2>Start a Jupyter Notebook Server<a class="headerlink" href="#Start-a-Jupyter-Notebook-Server" title="Permalink to this headline">¶</a></h2>
<p>First create a directory where you will run the jupyter notebook, let’s call it /tutorial.</p>
<p>Let’s submit a job first to get it going. You can create a shell script by copying the following commands into a script file. Let’s name it as run_ipynb_job.sh. Or you can download the example script here. We request 2 notes with 32 CPU and 64GB memory in this instance. Further instructions about job submission and running jobs on Raijin can be found <a class="reference external" href="https://opus.nci.org.au/display/Help/Running+Jobs">here</a>.</p>
<p><strong>You can modify your project name and project code as needed in the first two lines.</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#PBS -N pangeo_test</span>
<span class="c1">#PBS -P fp0</span>
<span class="c1">#PBS -q express</span>
<span class="c1">#PBS -l walltime=5:00:00</span>
<span class="c1">#PBS -l ncpus=32</span>
<span class="c1">#PBS -l mem=64GB</span>
<span class="c1">#PBS -l jobfs=100GB</span>
<span class="n">module</span> <span class="n">load</span> <span class="n">pangeo</span><span class="o">/</span><span class="mf">2019.10</span>
<span class="n">pangeo</span><span class="o">.</span><span class="n">ini</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">sh</span>
<span class="n">sleep</span> <span class="n">infinity</span>
</pre></div>
</div>
<p><img alt="3" src="../../_images/pangeo_setup3.png" /></p>
<p>Once the job is complete, there are two files appearing in your current directory.</p>
<ul class="simple">
<li>client_cmd</li>
<li>scheduler.json</li>
</ul>
<p><img alt="4" src="../../_images/pangeo_setup4.png" /></p>
<p>Note the port number underlined in the screenshot will be needed when interacting Raijin from your local computer later.</p>
</div>
<div class="section" id="Launch-the-jupyterlab-on-your-local-computer">
<h2>Launch the jupyterlab on your local computer<a class="headerlink" href="#Launch-the-jupyterlab-on-your-local-computer" title="Permalink to this headline">¶</a></h2>
<p>Open a termial in your local computer. Copy and past the content of the client_cmd in the command line. They are actually two commands login into Raijin from your local computer.</p>
<p><img alt="5" src="../../_images/pangeo_setup5.png" /></p>
<p>Open a web brower, type the following and enter. The jupyter notebook port number is 8343 in this example.</p>
<p><strong>Don’t copy this number as it might be different in your case!</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">localhost</span><span class="p">:</span><span class="mi">8343</span>
</pre></div>
</div>
<p><img alt="6" src="../../_images/pangeo_setup6.png" /></p>
<p>Then it will prompt the password. Type the password that you set up in the second step in this tutorial.</p>
<p><img alt="7" src="../../_images/pangeo_setup7.png" /></p>
<p>Once your authentication passed, a jupyterlab interface will be launched in a few seconds.</p>
<p><img alt="8" src="../../_images/pangeo_setup8.png" /></p>
<p>Now you are ready to run your own notebooks.</p>
<div class="section" id="IMPORTANT-NOTES">
<h3>IMPORTANT NOTES<a class="headerlink" href="#IMPORTANT-NOTES" title="Permalink to this headline">¶</a></h3>
<p>Please make sure the following two lines are added at the beginning and the end of the notebook.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># start the dask client
client =  Client(scheduler_file=&#39;scheduler.json&#39;)

# stop the pbs job.
! pangeo.end.sh
</pre></div>
</div>
</div>
</div>
<div class="section" id="Let’s-import-a-notebook-example">
<h2>Let’s import a notebook example<a class="headerlink" href="#Let’s-import-a-notebook-example" title="Permalink to this headline">¶</a></h2>
<p>You can drag and drop a notebook from your local computer into this Jupyterlab. Then the file will also appear in your working directory in Raijin.</p>
<p><img alt="9" src="../../_images/pangeo_setup9.png" /></p>
<p>The screen shot above shows</p>
<ul class="simple">
<li>left: jupyter notebook interface</li>
<li>up right: local dir where a notebook is dragged and dropped into the Jupyterlab</li>
<li>down right: Raijin command window showing the notebook appears instantly</li>
</ul>
</div>
<div class="section" id="View-the-DASK-job-dashboard">
<h2>View the DASK job dashboard<a class="headerlink" href="#View-the-DASK-job-dashboard" title="Permalink to this headline">¶</a></h2>
<p>Open a new tab in the web browser, type the following, the second port in the client_cmd file. If the job starts running, you should be able to see the dynamic resources of the processing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">localhost</span><span class="p">:</span><span class="mi">8890</span>
</pre></div>
</div>
<p><img alt="10" src="../../_images/pangeo_setup10.png" /></p>
</div>
<div class="section" id="Reference">
<h2>Reference<a class="headerlink" href="#Reference" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://pangeo.io">http://pangeo.io</a></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, NCI

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>